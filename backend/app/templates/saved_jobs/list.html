{% extends "base.html" %}

{% block title %}Saved Jobs - Texas Ed Jobs{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="flex items-center justify-between">
        <h1 class="text-3xl font-bold">Saved Jobs</h1>
        <span class="badge badge-lg">{{ saved_jobs | length }} saved</span>
    </div>

    {% if saved_jobs %}
    <div class="space-y-4">
        {% for saved in saved_jobs %}
        {% set job = saved.job_posting %}
        <div class="card bg-base-100 shadow-md border border-base-200" id="saved-card-{{ job.id }}">
            <div class="card-body p-4">
                <div class="flex items-start justify-between gap-4">
                    <div class="flex-1 min-w-0">
                        <a href="/jobs/{{ job.id }}" class="font-semibold text-primary hover:underline text-lg">
                            {{ job.title }}
                        </a>
                        <p class="text-sm text-base-content/60 mt-1">
                            {{ job.organization.name if job.organization else "Unknown" }}
                        </p>
                        <div class="flex flex-wrap gap-1 mt-2">
                            {% if job.category %}
                            <span class="badge badge-primary badge-sm">{{ job.category }}</span>
                            {% endif %}
                            {% if job.city %}
                            <span class="badge badge-ghost badge-sm">{{ job.city }}</span>
                            {% endif %}
                            {% if job.platform %}
                            <span class="badge badge-outline badge-sm">{{ job.platform }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="flex items-center gap-2 shrink-0">
                        <!-- Apply button -->
                        <a href="{{ job.application_url }}" target="_blank" rel="noopener"
                           class="btn btn-success btn-sm"
                           onclick="fetch('/api/v1/interactions/apply-click/{{ job.id }}', {method:'POST', credentials:'same-origin', headers:{'X-CSRF-Token': document.querySelector('meta[name=csrf-token]').content}})">
                            Apply
                        </a>
                        <!-- Unsave button -->
                        {% set job_id = job.id %}
                        {% set is_saved = true %}
                        {% include "partials/save_button.html" with context %}
                    </div>
                </div>

                <!-- Notes section -->
                <div class="mt-3 pt-3 border-t border-base-200">
                    <form hx-put="/api/v1/interactions/save/{{ job.id }}/notes"
                          hx-target="#notes-status-{{ job.id }}"
                          hx-swap="innerHTML"
                          class="flex gap-2 items-end">
                        <div class="form-control flex-1">
                            <label class="label py-1"><span class="label-text text-xs">Notes</span></label>
                            <textarea name="notes" rows="2"
                                      class="textarea textarea-bordered textarea-sm w-full"
                                      placeholder="Add notes about this job...">{{ saved.notes or '' }}</textarea>
                        </div>
                        <div class="flex flex-col gap-1">
                            <button type="submit" class="btn btn-ghost btn-xs">Save</button>
                            <span id="notes-status-{{ job.id }}" class="text-xs"></span>
                        </div>
                    </form>
                </div>

                <div class="text-xs text-base-content/40 mt-2">
                    Saved {{ saved.created_at.strftime('%b %d, %Y') }}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="flex flex-col items-center justify-center py-16 text-base-content/50">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
        </svg>
        <p class="text-lg font-medium">No saved jobs yet</p>
        <p class="text-sm mt-1">Browse jobs and click the bookmark icon to save them here.</p>
        <a href="/" class="btn btn-primary btn-sm mt-4">Find Jobs</a>
    </div>
    {% endif %}
</div>
{% endblock %}
