{% extends "base.html" %}

{% block title %}Jobs - Texas Ed Jobs{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <div>
            <h1 class="text-3xl font-bold">Job Listings</h1>
            <p class="text-base-content/70">{{ total }} jobs found</p>
        </div>
        <a href="/jobs/map" class="btn btn-outline btn-sm gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
            </svg>
            View Map
        </a>
    </div>

    <!-- Filters -->
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <form action="/jobs" method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Search</span>
                    </label>
                    <input type="text" name="search" value="{{ filters.search | default('') }}"
                           placeholder="Job title..."
                           class="input input-bordered w-full">
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Category</span>
                    </label>
                    <select name="category" class="select select-bordered w-full">
                        <option value="">All Categories</option>
                        {% for cat in categories %}
                        <option value="{{ cat }}" {% if filters.category == cat %}selected{% endif %}>{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">City</span>
                    </label>
                    <input type="text" name="city" value="{{ filters.city | default('') }}"
                           placeholder="City..."
                           class="input input-bordered w-full">
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Platform</span>
                    </label>
                    <select name="platform" class="select select-bordered w-full">
                        <option value="">All Platforms</option>
                        {% for plat in platforms %}
                        <option value="{{ plat }}" {% if filters.platform == plat %}selected{% endif %}>{{ plat }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="md:col-span-4 flex justify-end gap-2">
                    <a href="/jobs" class="btn btn-ghost">Clear</a>
                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Job List -->
    <div class="space-y-4" id="job-list">
        {% for job in jobs %}
        <div class="card bg-base-100 shadow hover:shadow-lg transition-shadow">
            <div class="card-body">
                <div class="flex flex-col lg:flex-row justify-between items-start gap-4">
                    <div class="flex-1">
                        <a href="/jobs/{{ job.id }}" class="card-title text-primary hover:text-primary-focus">
                            {{ job.title }}
                        </a>
                        <p class="text-base-content/70 mt-1">{{ job.org_name | default("Unknown Organization") }}</p>
                        <div class="flex flex-wrap gap-2 mt-3">
                            {% if job.category %}
                            <span class="badge badge-primary">{{ job.category }}</span>
                            {% endif %}
                            {% if job.city %}
                            <span class="badge badge-ghost">{{ job.city }}</span>
                            {% endif %}
                            <span class="badge badge-outline">{{ job.platform }}</span>
                        </div>
                    </div>
                    <div class="flex flex-col items-end gap-2">
                        <a href="{{ job.application_url }}" target="_blank" rel="noopener"
                           class="btn btn-success btn-sm gap-1">
                            Apply
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        </a>
                        {% if job.posting_date %}
                        <span class="text-xs text-base-content/50">Posted {{ job.posting_date.strftime('%b %d, %Y') }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="alert">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-info shrink-0 w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>No jobs found matching your criteria. Try adjusting your filters.</span>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if total > limit %}
    <div class="flex justify-center">
        <div class="join">
            {% if page > 1 %}
            <a href="/jobs?{{ pagination_query }}&page={{ page - 1 }}" class="join-item btn">Previous</a>
            {% else %}
            <button class="join-item btn btn-disabled">Previous</button>
            {% endif %}

            <button class="join-item btn btn-disabled">Page {{ page }} of {{ ((total - 1) // limit) + 1 }}</button>

            {% if page * limit < total %}
            <a href="/jobs?{{ pagination_query }}&page={{ page + 1 }}" class="join-item btn">Next</a>
            {% else %}
            <button class="join-item btn btn-disabled">Next</button>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
